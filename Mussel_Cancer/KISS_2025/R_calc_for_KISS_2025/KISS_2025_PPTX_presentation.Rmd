---
date: ""
title: |
    Экологические аспекты распространения трансмиссивной неоплазии двустворчатых моллюсков (BTN) в поселениях мидий Тауйской губы Охотского моря
author: "В.М.Хайтов, Ю.Т.Маченко, И.В.Кожин, М.А.Майорова, С.С.Маловенда, П.П.Стрелков"
output: 
  officedown::rpptx_document
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(fig.show='hold',  warning=FALSE, message=FALSE, cache = TRUE, echo = FALSE)

opts_chunk$set(echo = FALSE, fig.cap = TRUE)

library(officedown)

```


```{r}

library(sf)
library(rnaturalearth)
library(rnaturalearthdata)


library(sp)
library(ggmap)
library(mapproj)
library(maps)

library(ggmap)
library(readxl)
library(ggrepel)
library(dplyr)
library(reshape2)
library(cowplot)
library(magrittr)
library(patchwork)
library(vegan)
library(mgcv)
library(gratia)
library(broom.mixed) 

library(rvg)

library(flextable)


default_theme <- 
  theme_bw() + 
  theme(axis.text = element_text(size = 15), axis.title = element_text(size = 20) )

theme_set(default_theme)
```


## Bivalvia Transmissible Neoplasia (BTN) — Заразный рак у двустворчатых моллюсков

:::::::::::::: {.columns}

:::{.column width="70%"}

- Раковые клетки гемолимфы являются инфекционным агентом
- Клон злокачественных клеток передается от одной особи к другой через морскую воду
- Впервые описано у *Mya arenaria*
- Заболевание выявлено у многих систематически далеких видов (*Mytilus*, *Cerastoderma* и др.)

:::

:::{.column width="30%"}


```{r, fig.cap="Схема заражения BTN", out.width="5%"}
include_graphics("./figure/Place_holder.png")

``` 

:::

::::::::::::::

## Клиническая картина заражения BTN у мидий

:::::::::::::: {.columns}

:::{.column width=70%}


- Зараженные моллюски внешне неотлчимы от здоровых
- Часто внешний вид мягких тканей выглядит "нездорово"
- На пункции гемолимфы из мускула замыкателя видны округлые клетки со слабой адгезией.

:::

:::{.column width=30%}


```{r, fig.cap="Внешний вид здоровых и раковых клеток гемолимфы", out.width="5%"}
include_graphics("./figure/Place_holder.png")

``` 

:::

::::::::::::::


## Диагностика BTN с помощью проточной цитометрии

:::::::::::::: {.columns}

:::{.column width=70%}


- Проточная цитометрия (окраска DAPI) позволяет обнаружить крупные полиплоидные неопластичные клетки

- По соотношению "здоровых" и "неоплоидных" клеток можно судить о стадии заболевания

:::

:::{.column width=30%}


```{r, fig.cap="Результаты проточной цитометрии", fig.width=4}

include_graphics("./figure/Place_holder.png")

``` 

:::

::::::::::::::

## Две эволюционные линии BTN у *Mytilus trossulus*

- BTN у *M.trossulus* возникал многократно. 
- Сейчас известно две линии: $_{mtr}BTN1$ и $_{mtr}BTN2$  
- Диагностика двух линий происходит по молекулярным маркерам 


# BTN  в окрестностях Магадана

## Почему Магадан?

:::::::::::::: {.columns}

:::{.column width=70%}

- Много доступных поселений мидий
- Представлен только один вид *Mytilus trossulus*

:::


:::{.column width=30%}

```{r}
points <- 
  read_excel("Data/Magadan_2021_2023_ecology.xlsx", sheet = "Points  characteristic 2021-23", na = "NA")

points_local <- 
  points %>% 
  filter(lat > 59.3)
```



```{r, fig.cap="Тауйская губа", out.width="100%"}

world <- ne_countries(scale = "large", returnclass = "sf")

# Фильтрация стран Евразии по континенту
eurasia <- subset(world, continent %in% c("Europe", "Asia"))



Pl_map_large <- 
ggplot(data = eurasia) +
  geom_sf(fill = "lightgreen", color = "gray30") +
  coord_sf(
    xlim = c(150, 153),   
    ylim = c(58.8, 59.8)    
  ) +
  geom_point(aes(x = 150.8, y = 59.566667), size = 4, color = "red") +
  theme(panel.grid = element_blank()) +
  labs(x = "Долгота", y = "Широта") +
  scale_x_continuous(breaks = seq(150, 153, by = 1)) +  # Шкала с шагом 1 градус
  scale_y_continuous(breaks = seq(58.8, 59.8, by = 0.5)) +  
  annotate( geom = "text", x = 150.8, y = 59.61, label = "Магадан")

Pl_map_large +
  geom_point(data = points, aes(x = lon, y = lat), size = 2)

``` 

:::

::::::::::::::


##  *Mytilus trossulus* в окрестностях Магадана

![Внешний вид литоральных поселений](figure/Place_holder.png)


## Обследованные точки 

:::::::::::::: {.columns}

:::{.column width=70%}

- Всего обследовано 11 точек в 2021 г. и 15 в 2023 г (всего 20 локаций). 
- На каждой точке собирали крупных мидий для отбора проб гемолимфы и оценки ростовых процессов
- Брали выборки для описания размерной структуры и плотности поселения мидий

:::


:::{.column width=30%}

```{r}
load("Data/gg_Magadan_large.RData")

Magadan <- data.frame(long = 150 + 48/60, lat = 59 + 34/60)

Pl_map <- 
ggplot(gg_Magadan_large, aes(x = long, y = lat, group = group)) + 
  geom_polygon(fill = "gray30") + 
  coord_map(xlim = c(150., 151.52), ylim = c(59.4, 59.8) ) +
  theme(plot.margin = unit(c(0, 0, 0, 0), "cm")) +
  theme_map() 


Pl_map +
  geom_point(data = points_local, aes(x = lon, y = lat, group = 1), shape = 21, fill = "yellow", size = 3) +
  scale_fill_manual(values =  c("gray50", "yellow")) +
  theme_minimal() +
  guides(fill = "none", size = "none") +
  labs(x = "Долгота", y = "Широта") +
  geom_point(data = Magadan, aes(x = long + 0.01), shape = 22, group = 1, fill = "red", size = 6)+
  geom_text(data =  Magadan, aes(x = long, y = lat+0.02, label = "Магадан", group = 1), color = "white")
  


```

:::

::::::::::::::


## Частота BTN в окрестностях Магадана

```{r}
cancer <- read_excel("Data/Cancer_Magadan_2021-2023.xlsx", na = "NA", sheet = "Magadan_cancer_prevalence")

cancer2 <-
  cancer %>%
  group_by(Year, Site, Sample_ID) %>%
  summarise(N_processed = sum(N_Processed), N_cancer = sum(BTN)) %>% 
  filter(Year == 2023)

```




```{r}
cancer %>% 
  group_by(Site) %>% 
  summarise(Total_processed = sum(N_Processed), Total_cancer = sum(BTN, na.rm = T)) %>% 
  mutate(Prop_BTN = Total_cancer/Total_processed * 100) ->
  prop_BTN

points %>% 
  group_by(Site) %>% 
  summarise(lon = mean(lon), lat = mean(lat)) ->
  points_general
  
prop_BTN <-
merge(points_general, prop_BTN)  

```



```{r}
Pl_map_BTN <- 
Pl_map + 
  geom_point(data = prop_BTN, aes(x = lon, y = lat, size = Prop_BTN, group = 1), shape = 21, fill = "yellow")

```


```{r}
Pl_hist <- 
  ggplot(prop_BTN, aes(x = Prop_BTN)) +
  geom_histogram(binwidth = 2) +
  labs(x = "Доля зараженных (%)", y = "Количество точек") +
  theme_bw()
```




:::::::::::::: {.columns}

:::{.column width=30%}

```{r, fig.cap = "Распределение инвазии: частота невелика" }
Pl_hist
```

:::


:::{.column width=70%}

```{r, fig.cap = "Частота BTN варьирует вдоль побережья", fig.height=5}
Pl_map_BTN
```


:::

::::::::::::::


# Связь частоты BTN1 и BTN2  с факторами среды

## Возможные предикторы



```{r, fig.cap="Соленость варьирует в очень узких пределах"}
points %>% 
  ggplot(aes(Salinity)) + 
  geom_histogram(binwidth = 5) +
  labs(x = "Соленость", y = "Количество участков")  +
  theme_bw()
```


## Возможные предикторы
 

![Расстояние от морского порта Магадана - косвенная оценка антропогенного влияния](figure/Place_holder.png)

## Возможные предикторы


![Fetch - открытость побепежья для прибоя](figure/Place_holder.png)



## Возможные предикторы


```{r}
# Данные по разновидности BTN
myt <- read_excel("Data/summary table_Magadan_itog.xlsx", sheet = "data")

myt <-
myt %>% 
  select(-Site) %>% 
  mutate(Site = Site_code)


myt %<>%
  mutate(BTN2 = BTN2.1 + BTN2.2)

myt_23 <- 
  myt %>% 
  filter(Year == 2023)

Prob_BTN1_total <- sum(myt$BTN1)/sum(myt$N)
Prob_BTN2_total <- sum(myt$BTN2)/sum(myt$N)


myt_23 %<>%
  select(-c(Site, Lat, Lon,  Date, BTN2.1, BTN2.2,  DN_FC  )) %>% 
  mutate(Site = Site_code)


```




```{r}

size <- read_excel("Data/Magadan_2021_2023_ecology.xlsx", na = "NA", sheet = "Размерная струкутра 2023 2021")

size <- size[complete.cases(size), ]

library(reshape2)

scam <- dcast(Year + Site ~ Size_class, data = size)

area <- read_excel("Data/Magadan_2021_2023_ecology.xlsx", na = "NA", sheet = "Площадь проб на размер")

sample_area <- 
  area %>% group_by(Year, Site) %>% summarise(Total_area = sum(Area))

scam <- 
  scam %>% group_by(Year, Site)


scam [ ,3:ncol(scam)] <- 
  round((scam[ ,3:ncol(scam)] / sample_area$Total_area) *10000, 0)




# scam_23 <- scam %>% filter(Year == 2023)


pca_scam <- rda(decostand(scam[ , -c(1,2)], method = "hellinger" ))

# plot(pca_scam, display = "sp")

sum_pca_scam <- summary(pca_scam)

pca_scam_size_scores <- as.data.frame(scores(pca_scam)$species)


pca_scam_scores <- as.data.frame(scores(pca_scam)$sites)

pca_scam_scores$N_Juv <- scam$L3    

pca_scam_scores$N_Large = scam$L8 + scam$L13 + scam$L18 + scam$L18 + scam$L23 + scam$L28 + scam$L33 + scam$L38 + scam$L43 

pca_scam_scores$N_Total <- scam$L3 + scam$L8 + scam$L13 + scam$L18 + scam$L23 + scam$L28 + scam$L33 + scam$L38 + scam$L43 + scam$L48 + scam$L53 + scam$L58

pca_scores_scam <- data.frame(Year = scam$Year, Site = scam$Site, pca_scam_scores)
```

```{r}
cover_23 <- read_excel("Data/Magadan_2021_2023_ecology.xlsx", sheet = "Покрытия миидий 2023")

mean_cover_23 <-
  cover_23 %>%
  group_by(Site) %>%
  summarise(Cover = mean(`Number of squares`/30))


# Анализ без объедиения проб сайтов

cancer <- 
  myt %>% 
  mutate(Prop_BTN1 = BTN1/N, Prop_BTN2 = (BTN2.1 + BTN2.2)/N, Prop_BTN2.1 = (BTN2.1)/N,  Prop_BTN2.2 = (BTN2.2)/N ) 


cancer2 <-
  cancer %>% 
  filter(Year == 2023) %>% 
  select(-Site) %>% 
  rename(Site = Site_code)




cancer_2023 <- 
  merge(points, cancer2) %>% 
  filter(Year == 2023)

pca_scores_scam_23 <- 
  pca_scores_scam %>% 
  filter(Year == 2023)

cancer_2023 <- 
merge(cancer_2023, pca_scores_scam_23)

cancer_2023 <- 
  merge(cancer_2023, mean_cover_23)



cancer_2023 <- 
  cancer_2023 %>% 
  mutate(BTN2 = BTN2.1 + BTN2.2,
         BTN2.1 = BTN2.1,
         BTN2.2 = BTN2.2)
```





```{r}
size_23 <- 
size %>% filter(Year == 2023)  

Sites <- 
pca_scores_scam_23 %>% arrange(PC1) %>% pull(Site) 

size_23$Site <- factor(size_23$Site, levels = Sites)

Pl_size_stricture <-
size_23 %>% 
  ggplot(., aes(x = L)) +
  geom_histogram(binwidth = 5) +
  facet_wrap(~Site, scales = "free_y", dir = "v") +
  theme_bw() +
  theme(strip.text = element_blank()) +
  labs(x = "Размерные классы (мм)", y = "Частота")
  
```

```{r, fig.width=7, fig.cap="Размерная структура - значительно различается между участками"}
Pl_size_stricture  
```


## Возможные предикторы

:::::::::::::: {.columns}

:::{.column width=70%}

### Размерная структура

- Матрица обилия размерных классов использована для компонентного анализа (PCA)
- Значения **PC1** (48% общей дисперсии) обобщенное описание размерной структуры 
- **PC1** отражает обилие молоди

:::

:::{.column width=30%}


```{r, fig.cap="Cвязь доли молоди со значениями PC1." }
ggplot(pca_scores_scam, aes(PC1, N_Juv/(N_Juv + N_Large))) + 
  geom_text(aes(label = Site)) +
  labs(x = "Значения PC1", y = "Доля молоди") +
  geom_smooth(method = "lm") +
  theme_bw()

```


:::

::::::::::::::


## Регрессионная модель


```{r}
# Модель для Prop_BTN1, Prop_BTN2.1 и Prop_BTN2.2 в одной модели #################

cancer_2023_long <- 
cancer_2023 %>% 
  select(Site, Salinity, Dist_Port, fetch, Sample, PC1, PC2, N_Large, N_Juv, N_Total, Cover, N, BTN1, BTN2) %>%
  mutate(Sample = 1:nrow(.)) %>% 
  melt(., id.vars = c("Site", "Salinity", "Dist_Port", "fetch",  "Sample", "PC1", "PC2", "N_Large", "N_Juv", "N_Total",  "Cover", "N"), variable.name = "Lineage", value.name = "N_cancer") %>% 
  mutate(N_helthy = N - N_cancer)


# Проверка на колинеарность предикторов
# df <-
# cancer_2023_long %>%
#   filter(Lineage == "BTN1")
# 
# mod_foo <- lm(BTN1 ~ Dist_Port + fetch + PC1 + Cover, data = cancer_2023)
# 
# library(car)
# vif(mod_foo)

cancer_2023_long$Site <- factor(cancer_2023_long$Site)

# Mod_btn1_btn2 <- gam(cbind(N_cancer, N_helthy) ~ s((Dist_Port), by = Lineage, k = 5, bs = "tp") + s((fetch), by = Lineage, k = 5, bs = "tp")  + s((PC1), by = Lineage, k = 5, bs = "tp") +  Lineage + s(Site, bs = "re"),  family = "binomial", method = "REML", data = cancer_2023_long )

# summary(Mod_btn1_btn2)


Mod_btn1_btn2_no_re <- gam(cbind(N_cancer, N_helthy) ~ s((Dist_Port), by = Lineage, k = 10, bs = "tp") + s((fetch), by = Lineage, k = 10, bs = "tp")  + s((PC1), by = Lineage, k = 10, bs = "tp")  +  Lineage,  family = "binomial", method = "REML", data = cancer_2023_long )

# AIC(Mod_btn1_btn2, Mod_btn1_btn2_no_re)

# summary(Mod_btn1_btn2_no_re)

mod_sum <- tidy(Mod_btn1_btn2_no_re)

# draw(Mod_btn1_btn2_no_re)
```




$$
GAM : Prevalence = s(Dist_{Port}|Lineage) + s(Fetch|Lineage) + s(PC1|Lineage) + Lineage
$$

- Логистическая обобщенная аддитивная модель (GAM)
- Зависимая переменная ($Prevalence$): Биномиальное распределение
- Cглаживающие функции подобраны для $BTN1$ и $BTN2$ отдельно


## Регрессионная модель


```{r}
ft <- flextable(mod_sum)

ft <-
  ft %>% 
  colformat_double(j = 2:4, digits = 1) %>% 
  colformat_double(j = 5, digits = 3) %>% 
  bg(i = c(1, 3, 5), bg = "yellow", part = "body") %>% 
  set_header_labels(statistic = "Chi.sq Statistic",
                    term = "Член модели") %>% 
  set_caption(caption = "Парамтеры GAM")
```


```{r}
ft
```

## **Предсказание модели**

```{r, fig.cap="Частота BTN1 убывает по мере приблежения к источникам антропогенного загрязнения"}
draw(Mod_btn1_btn2_no_re, select = 1) +
  ggtitle("", subtitle = "") + 
  labs(x = "Растояние от порта (км)")  +
  theme_bw()
```



## **Предсказание модели**  

```{r, fig.cap="Частота BTN1 увеличивается на участках открытых для прибоя"}
draw(Mod_btn1_btn2_no_re, select = 3) +
  ggtitle("", subtitle = "") + 
  labs(x = "Fetch (км)")  +
  theme_bw()
```



## **Предсказание модели**   

```{r, fig.cap="Частота BTN1 увеличивается на участках с высокой долей молоди"}
draw(Mod_btn1_btn2_no_re, select = 5) +
  ggtitle("", subtitle = "") + 
  labs(x = "PC1")  +
  theme_bw()
```

## Стратегия BTN1

1. Клетки $BTN1$ циркулируют в поселениях мидий, которые представлены в наиболее благоприятных для хозяина условиях

2. Альтернативное объяснение: клетки BTN1 могут быть детектированы только в тех условиях, где хозяин имеет максимальные шансы выжить.

# Влияние BTN на хозяина

## Показатели жизненных функций мидий 


:::::::::::::: {.columns}

:::{.column width=70%}

На материале 2021 и 2023 гг у мидий  оценивали 

- Репродуктивный статус (микроскопирование мазков гонад)
- Прирост последнего года и размер раковины до последнего кольца остановки роста   

:::


:::{.column width=30%}

![](figure/Place_holder.png)

:::

::::::::::::::


```{r}
# Данные по индивидуальным характристикам мидий
myt_ind <- read_excel("Data/Mussel_growth_Magadan_2021_2023.xlsx", na = "NA")

myt_ind$Sample <- paste(myt_ind$Site_code, myt_ind$Sample, sep = "_")


# Удаляем идий, которые были испольованы для анализа роста, но не анализировались с для определения BTN

myt_ind %<>%
  filter(!is.na(DN))


myt_ind$DN <- factor(myt_ind$DN)
myt_ind$Site_code <- factor(myt_ind$Site_code)
myt_ind$Sample <- factor(myt_ind$Sample)
myt_ind$Rate_of_aneuploid_cells <- as.numeric(myt_ind$Rate_of_aneuploid_cells)

myt_ind %<>%
  mutate(Prop_Increment = Increment/L) %>% 
  mutate(BTN_Type = case_when(BTN_genotype == "BTN1" ~ "BTN1",
                              BTN_genotype %in% c("BTN2.1", "BTN2.2") ~ "BTN2",
                              BTN_genotype == "healthy" ~ "healthy"))

myt_ind$BTN_Type <- factor(myt_ind$BTN_Type)


myt_ind %<>%
  mutate(Gonad_quality = case_when(Sex == "male" ~ "Developed",
                                   Sex == "female" ~ "Developed",
                                   Sex == "no gametes" ~ "No"))


myt_ind <-
  myt_ind %>% 
  filter(!is.na(BTN_Type))



# myt_ind %>%  
#   filter(!is.na(Sex)) %>% 
#   ggplot(aes(BTN_Type, Prop_Increment, fill = BTN_Type)) +
#   geom_boxplot() +
#   facet_grid(Sex ~ Year)




myt_ind_clean <- 
  myt_ind %>%  
  filter(!is.na(BTN_Type)) %>% 
  filter(Sex != "hermaphrodite") %>% 
  filter(!is.na(Sex)) 

myt_ind_clean$Fi_Increment <- 2*asin(sqrt(myt_ind_clean$Prop_Increment)) * 180/pi

points <- read_excel("Data/Magadan_2021_2023_ecology.xlsx", sheet = "Points  characteristic 2021-23", na = "NA")

points %<>%
  rename(Site_code = Site)


# points_2023 <- 
#   points %>% 
#   filter(Year == 2023) %>% 
#   rename(Site_code = Site)

myt_ind_clean <- merge(myt_ind_clean, points)


myt_ind_clean$BTN_Type <- factor(myt_ind_clean$BTN_Type, labels = c("BTN1", "BTN2", "Здоровые"))

myt_ind_clean$Gonad_quality <- factor(myt_ind_clean$Gonad_quality, labels = c("Есть гаметы", "Нет гамет"))

```


## BTN и репродуктивный статус хозяина

```{r, fig.cap="У мидий, зараженных BTN, часто нарушено развитие гонад"}

myt_ind_clean %>%
  group_by(Year, BTN_Type, Gonad_quality) %>%  # Группируем по годам и типам BTN
  summarise(Frequency = n(), .groups = 'drop') %>%  # Считаем количество наблюдений
  group_by(Year, BTN_Type) %>%  # Группируем для вычисления долей
  mutate(Frequency = Frequency / sum(Frequency)) %>%  # Преобразуем в доли
  ggplot(aes(x = "", y = Frequency, fill = Gonad_quality)) +
  geom_bar(stat = "identity", width = 1, color = "black") +
  coord_polar("y", start = 0) +
  theme_void() +
  facet_grid(Year ~ BTN_Type) + # Разделяем на подграфики по годам и типам BTN
  scale_fill_manual(values = c("green", "red")) +
  labs(fill = "") +
  theme_bw()

```


## Зависимость частоты нарушения развития гонад от степени развития заболевания

```{r}

myt_ind_clean %>%
  mutate(Gonad_Out = ifelse(Gonad_quality == "Нет гамет", 1, 0)) %>% 
  filter(BTN_Type != "Здоровые") ->
  myt_ind_clean_not_healthy

myt_ind_clean_not_healthy <-
  myt_ind_clean_not_healthy %>% 
  mutate(Lineage = BTN_Type, Aneuploid_Proportion = Rate_of_aneuploid_cells)


Mod_gonad <- gam(Gonad_Out ~ s(Aneuploid_Proportion, by = Lineage) + Lineage , family = "binomial",  method = "REML", data = myt_ind_clean_not_healthy)

mod_sum2 <- tidy(Mod_gonad)
```


```{r}
ft <- flextable(mod_sum2)

ft <-
  ft %>% 
  colformat_double(j = 2:4, digits = 1) %>% 
  colformat_double(j = 5, digits = 3) %>% 
  bg(i = c(1), bg = "yellow", part = "body") %>% 
  set_header_labels(statistic = "Chi.sq Statistic",
                    term = "Член модели") %>% 
  set_caption(caption = "Парамтеры GAM")

ft
```

## **Пердсказание модели**




:::::::::::::: {.columns}

:::{.column width=70%}

```{r, fig.cap= "Для BTN1 заметные нарушения наблюдаются только на самых поздних стадиях заболевания"}
draw(Mod_gonad, select = 1, scales = "fixed") +
  geom_hline(yintercept = 0, linetype = 2) +
  ggtitle("BTN1", subtitle = "") +
  labs(x = "Доля (%) анеуплоидных клеток") +
  ylim(-5, 4)+
  annotate(geom = "text", x = 25, y = 0.5, label = "Среднее значение")  +
  theme_bw()

  
  
```


:::


:::{.column width=30%}

```{r, fig.cap= "Для BTN2 нарушения наблюдаются на всех стадиях заболевания"}
draw(Mod_gonad,  scales = "fixed", select = 2) +
  geom_hline(yintercept = 0, linetype = 2) +
  ggtitle("BTN1", subtitle = "") +
  labs(x = "Доля (%) анеуплоидных клеток") +
  ylim(-5, 4) +
  annotate(geom = "text", x = 25, y = 0.5, label = "Среднее значение")  +
  theme_bw()

```


:::

::::::::::::::


## Влияние BTN на рост моллюсков

```{r}
Mod_prop_incr_btn <- gam(Fi_Increment ~ BTN_Type + s(Last_ring, bs = "cr", by = BTN_Type)  + s(Sample, bs = "re"), family = "gaussian", data = myt_ind_clean, method = "REML")

```

```{r}
Pl_Last_ring <- 
  draw(Mod_prop_incr_btn, grouped_by = T, select = c(1, 2, 3)) + 
  xlim(20, 55) +
  ylim(-30, 30) +
  labs(fill = "", color = "Статус", x = "Расстояние до последнего кольца") +
  ggtitle(NULL, subtitle = NULL)  +
  theme_bw()
```


```{r}

My_data <- data.frame(BTN_Type = levels(myt_ind_clean$BTN_Type), Last_ring = mean(myt_ind_clean$Last_ring))



Predicted <- predict(Mod_prop_incr_btn, newdata = My_data, exclude = "s(Sample)", newdata.guaranteed=TRUE, se.fit = TRUE)

My_data$Fit <- Predicted$fit
My_data$SE <- Predicted$se.fit

Fi_back <- function(x) (sin((x*pi)/360))^2

My_data$P_incr <- Fi_back(My_data$Fit)
My_data$upr <- Fi_back(My_data$Fit + 1.96*My_data$SE)
My_data$lwr <- Fi_back(My_data$Fit - 1.96*My_data$SE)


library(itsadug)

# wald_gam(Mod_prop_incr_btn)



library(ggeffects)

My_data <-
as.data.frame(ggpredict(Mod_prop_incr_btn, terms = "BTN_Type", typical = "weighted.mean")) %>% 
  select(x, predicted, conf.low, conf.high) %>% 
  mutate(P_incr = Fi_back(predicted), upr = Fi_back(conf.high), lwr = Fi_back(conf.low), BTN_Type = x )

library(ggsignif)

Pl_Status <-
  ggplot(My_data, aes(x = BTN_Type, y = P_incr)) +
  geom_col(fill = "gray") +
  geom_errorbar(aes(ymin = lwr, ymax = upr), width = 0.2) +
  labs(x = "", y = "Partial effect") +
  geom_signif(comparisons = list(
      c("BTN1", "BTN2"),
      c("BTN2", "Здоровые")),
      annotations = c("W = 6.5, p = 0.011", "W = 7.5, p = 0.006")
      )  +
  theme_bw()
  
  
```






:::::::::::::: {.columns}

:::{.column width=70%}

```{r, fig.cap="По мере увеличения размеров прирост последнего года закономерно снижается"}
Pl_Last_ring
```

:::


:::{.column width=30%}

```{r, fig.cap="Прирост последнего года у зараженных BTN2 оказывается выше, чем у зараженных BTN1 и у здоровых особей"}
Pl_Status
```


:::

::::::::::::::

## Стратегия BTN2

- Заражение BTN2, по-видимому, стимулирует рост хозяина. 
- Этот эффект аналогичен феномену паразитарной кастрации
- Подобная стратегия может объяснять меньшую зависимость BTN2 от внешних условий: тонко настраивая использование ресурсов хозяина, клетки BTN2 получают больше энергии
- Это обеспечивает BTN2 более широкое распространение и меньшую зависимость от варьирования внешних факторов.

# Спасибо за внимание!


