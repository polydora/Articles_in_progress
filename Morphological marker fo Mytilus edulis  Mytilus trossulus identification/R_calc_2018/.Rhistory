# Подразделяем данные на сабсеты
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "normal"] <- "BH"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "normal"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "Baltic"] <- "BALT"
myt2_all$Subset[myt2_all$sea == "GOM"] <- "GOM"
myt2_all$Subset[myt2_all$sea == "Norway"] <- "NORW"
myt2_all$Subset[myt2_all$sea == "Scotland"] <- "SCOT"
myt2_all$Subset <- factor(myt2_all$Subset, levels = c("WSBL", "BH", "BALT", "GOM", "NORW" , "SCOT"))
myt2 <- myt2_all %>% filter(Subset %in% c("WSBL", "BH", "BALT", "GOM" ))
# Бинарное обозначение видов
myt2$Sp2 <- ifelse(myt2$Sp == "M.trossulus", 1, 0)
#Correct identification
myt2$congr <- ifelse((myt2$ind == 1 & myt2$Sp == "M.trossulus") | (myt2$ind == 0 & myt2$Sp == "M.edulis"), 1, 0   )
# Частота M.trossulus в популяции, вычисленная как срденее значение structure
freq_MT <- summaryBy( str ~ pop, data = myt2)
names(freq_MT) <- c("pop", "freq_MT")
myt2 <- merge(myt2, freq_MT)
theme_set(theme_bw())
Pl_base <- ggplot(myt2, aes(x = freq_MT, y = str)) + scale_fill_gradient(low = "yellow", high = "red") + guides(fill = "none") + labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure") + facet_wrap(~Subset)
# + geom_density2d()
# Pl_base + geom_point(aes(fill = ind), shape = 21)
# Chunk 3
mod_gam <- gam(ind ~ s(str, freq_MT, by = Subset, bs = "tp", k = 10) + Subset, data = myt2, family = "binomial")
# summary(mod_gam)
# Chunk 4
myt2_WSBL <- myt2 %>% filter(Subset == "WSBL")
myt2_BH <- myt2 %>% filter(Subset == "BH")
myt2_BALT <- myt2 %>% filter(Subset == "BALT")
myt2_GOM <- myt2 %>% filter(Subset == "GOM")
new_data <-  myt2 %>% group_by(Subset) %>% do(expand.grid(str = seq(min(.$str), max(.$str), length.out = 20), freq_MT = seq(min(.$freq_MT), max(.$freq_MT), length.out = 20)))
new_data$Predict_gam <- predict(mod_gam, newdata = new_data, type = "response" )
Pl_mod_gam <-
ggplot(new_data, aes(x = freq_MT, y = str)) +
geom_raster(aes(fill = Predict_gam)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt2_WSBL, color = "white")+
geom_density_2d(data = myt2_BH, color = "white")+
geom_density_2d(data = myt2_BALT, color = "white")+
geom_density_2d(data = myt2_GOM, color = "white", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(data = myt2, aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_empty <- ggplot() + theme(panel.border = element_blank())
# Chunk 5
# prop_T <- myt2 %>%  mutate(str_class = ntile(str, 5)) %>% group_by(Subset, str_class) %>% summarise(str_mean = mean(str), Prop_T = mean(ind))
#
Pl_hist <-
ggplot(myt2, aes(x = str)) +
geom_histogram(binwidth = 0.1, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(binwidth = 0.1, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
# Chunk 6
library(cowplot)
library(patchwork)
# Pl_hist + (Pl_mod_gam/ Pl_empty)
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_empty,Pl_empty, Pl_empty, ncol = 2,  rel_widths = c(0.5, 1))
Pl_empty
Pl_hist <-
ggplot(myt2, aes(x = str)) +
geom_histogram(bin = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist <-
ggplot(myt2, aes(x = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(bins = 0.1, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
library(cowplot)
library(patchwork)
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_empty,Pl_empty, Pl_empty, ncol = 2,  rel_widths = c(0.5, 1))
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(bins = 0.1, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(bins = 0.1, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
library(cowplot)
library(patchwork)
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_empty,Pl_empty, Pl_empty, ncol = 2,  rel_widths = c(0.5, 1))
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_empty,Pl_empty, Pl_empty, ncol = 2,  rel_widths = c(0.5, 1))
Pl_hist_2 <-
ggplot(myt3, aes(x = freq_MT, y = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
myt3
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
myt3
myt2_all
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
myt3
Pl_no_gam <- ggplot(myt2_all %>% filter(Subset %in% c("NORW", "SCOT")), aes(x = )) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_no_gam
Pl_no_gam <- ggplot(myt2_all %>% filter(Subset %in% c("NORW", "SCOT")), aes(x = freq_MT, y = ind)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_no_gam
myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_no_gam <- ggplot(myt2_all %>% filter(Subset %in% c("NORW", "SCOT")), aes(x = freq_MT, y = str)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_no_gam
myt3
freq_MT <- summaryBy( str ~ pop, data = myt2_all)
names(freq_MT) <- c("pop", "freq_MT")
library(lme4)
library(ggplot2)
library(reshape2)
library(sjstats)
library(dplyr)
library(car)
library(doBy)
library(pROC)
library(betareg)
library(lmtest)
library(broom)
library(mgcv)
myt <- read.table("data_salinity3.csv", header = T, sep = ",")
#
# myt_overseas <- myt[myt$dataset == "overseas", ]
#
# myt <- myt[myt$dataset != "overseas", ]
# str(myt)
myt$Sp [myt$str > 0.5] <- "M.trossulus" #Лучше обозначать так!
myt$Sp [myt$str <= 0.5] <- "M.edulis"
myt$Sp <- factor(myt$Sp)
# Оставляем только мидий, у которых есть оценка морфотипа
myt2_all <- myt[!is.na(myt$ind), ]
# Вводим обозначения для морфотипов
myt2_all$morph <- ifelse(myt2_all$ind == 1, "T_m", "E_m")
myt2_all$morph <- factor(myt2_all$morph)
### Объединяем популяции в данных Сары #####
# myt2_all$pop2 <- myt2_all$pop
#
# myt2_all$pop[myt2_all$pop %in% c("CBCP", "CBSC")] <- "CB"
#
# myt2_all$pop[myt2_all$pop %in% c("MDRE",   "MDRW")] <- "MDR"
# Подразделяем данные на сабсеты
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "normal"] <- "BH"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "normal"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "Baltic"] <- "BALT"
myt2_all$Subset[myt2_all$sea == "GOM"] <- "GOM"
myt2_all$Subset[myt2_all$sea == "Norway"] <- "NORW"
myt2_all$Subset[myt2_all$sea == "Scotland"] <- "SCOT"
myt2_all$Subset <- factor(myt2_all$Subset, levels = c("WSBL", "BH", "BALT", "GOM", "NORW" , "SCOT"))
# Частота M.trossulus в популяции, вычисленная как срденее значение structure
freq_MT <- summaryBy( str ~ pop, data = myt2_all)
names(freq_MT) <- c("pop", "freq_MT")
myt2_all <- merge(myt2_all, freq_MT)
myt2 <- myt2_all %>% filter(Subset %in% c("WSBL", "BH", "BALT", "GOM" ))
# Бинарное обозначение видов
myt2$Sp2 <- ifelse(myt2$Sp == "M.trossulus", 1, 0)
#Correct identification
myt2$congr <- ifelse((myt2$ind == 1 & myt2$Sp == "M.trossulus") | (myt2$ind == 0 & myt2$Sp == "M.edulis"), 1, 0   )
theme_set(theme_bw())
Pl_base <- ggplot(myt2, aes(x = freq_MT, y = str)) + scale_fill_gradient(low = "yellow", high = "red") + guides(fill = "none") + labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure") + facet_wrap(~Subset)
# + geom_density2d()
# Pl_base + geom_point(aes(fill = ind), shape = 21)
# Chunk 1: setup
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE)
library(knitr)
# Chunk 2
library(lme4)
library(ggplot2)
library(reshape2)
library(sjstats)
library(dplyr)
library(car)
library(doBy)
library(pROC)
library(betareg)
library(lmtest)
library(broom)
library(mgcv)
myt <- read.table("data_salinity3.csv", header = T, sep = ",")
#
# myt_overseas <- myt[myt$dataset == "overseas", ]
#
# myt <- myt[myt$dataset != "overseas", ]
# str(myt)
myt$Sp [myt$str > 0.5] <- "M.trossulus" #Лучше обозначать так!
myt$Sp [myt$str <= 0.5] <- "M.edulis"
myt$Sp <- factor(myt$Sp)
# Оставляем только мидий, у которых есть оценка морфотипа
myt2_all <- myt[!is.na(myt$ind), ]
# Вводим обозначения для морфотипов
myt2_all$morph <- ifelse(myt2_all$ind == 1, "T_m", "E_m")
myt2_all$morph <- factor(myt2_all$morph)
### Объединяем популяции в данных Сары #####
# myt2_all$pop2 <- myt2_all$pop
#
# myt2_all$pop[myt2_all$pop %in% c("CBCP", "CBSC")] <- "CB"
#
# myt2_all$pop[myt2_all$pop %in% c("MDRE",   "MDRW")] <- "MDR"
# Подразделяем данные на сабсеты
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "normal"] <- "BH"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "normal"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "Baltic"] <- "BALT"
myt2_all$Subset[myt2_all$sea == "GOM"] <- "GOM"
myt2_all$Subset[myt2_all$sea == "Norway"] <- "NORW"
myt2_all$Subset[myt2_all$sea == "Scotland"] <- "SCOT"
myt2_all$Subset <- factor(myt2_all$Subset, levels = c("WSBL", "BH", "BALT", "GOM", "NORW" , "SCOT"))
# Частота M.trossulus в популяции, вычисленная как срденее значение structure
freq_MT <- summaryBy( str ~ pop, data = myt2_all)
names(freq_MT) <- c("pop", "freq_MT")
myt2_all <- merge(myt2_all, freq_MT)
myt2 <- myt2_all %>% filter(Subset %in% c("WSBL", "BH", "BALT", "GOM" ))
# Бинарное обозначение видов
myt2$Sp2 <- ifelse(myt2$Sp == "M.trossulus", 1, 0)
#Correct identification
myt2$congr <- ifelse((myt2$ind == 1 & myt2$Sp == "M.trossulus") | (myt2$ind == 0 & myt2$Sp == "M.edulis"), 1, 0   )
theme_set(theme_bw())
Pl_base <- ggplot(myt2, aes(x = freq_MT, y = str)) + scale_fill_gradient(low = "yellow", high = "red") + guides(fill = "none") + labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure") + facet_wrap(~Subset)
# + geom_density2d()
# Pl_base + geom_point(aes(fill = ind), shape = 21)
# Chunk 3
mod_gam <- gam(ind ~ s(str, freq_MT, by = Subset, bs = "tp", k = 10) + Subset, data = myt2, family = "binomial")
# summary(mod_gam)
# Chunk 4
myt2_WSBL <- myt2 %>% filter(Subset == "WSBL")
myt2_BH <- myt2 %>% filter(Subset == "BH")
myt2_BALT <- myt2 %>% filter(Subset == "BALT")
myt2_GOM <- myt2 %>% filter(Subset == "GOM")
new_data <-  myt2 %>% group_by(Subset) %>% do(expand.grid(str = seq(min(.$str), max(.$str), length.out = 20), freq_MT = seq(min(.$freq_MT), max(.$freq_MT), length.out = 20)))
new_data$Predict_gam <- predict(mod_gam, newdata = new_data, type = "response" )
Pl_mod_gam <-
ggplot(new_data, aes(x = freq_MT, y = str)) +
geom_raster(aes(fill = Predict_gam)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt2_WSBL, color = "white")+
geom_density_2d(data = myt2_BH, color = "white")+
geom_density_2d(data = myt2_BALT, color = "white")+
geom_density_2d(data = myt2_GOM, color = "white", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(data = myt2, aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_empty <- ggplot() + theme(panel.border = element_blank())
# Chunk 5
# prop_T <- myt2 %>%  mutate(str_class = ntile(str, 5)) %>% group_by(Subset, str_class) %>% summarise(str_mean = mean(str), Prop_T = mean(ind))
#
Pl_hist <-
ggplot(myt2, aes(x = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_hist_2 <-
ggplot(myt3, aes(x = freq_MT, y = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
library(cowplot)
library(patchwork)
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
Pl_no_gam <- ggplot(myt3, aes(x = freq_MT, y = str)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black", n = 5) +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_no_gam
Pl_no_gam <- ggplot(myt3, aes(x = freq_MT, y = str)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black") +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1)
Pl_no_gam
Pl_no_gam <- ggplot(myt3, aes(x = freq_MT, y = str)) +
facet_wrap(~Subset, ncol = 1) +
scale_fill_gradient(low = "cornflowerblue", high = "red") +
theme_bw() +
labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure score", fill = "Probability of\nТ-morphotype \npresence") +
geom_density_2d(data = myt3, color = "black") +
theme(panel.grid = element_blank()) +
geom_point(aes(fill = ind), position = position_jitter(width = 0.01), shape = 21, size = 1) +
xlim(0,1)
Pl_no_gam
plot_grid(Pl_hist_2, Pl_no_gam, ncol = 2,  rel_widths = c(0.5, 1))
Pl_hist_2
myt3 <- myt2_all %>% filter(Subset %in% c("NORW", "SCOT"))
Pl_hist_2 <-
ggplot(myt3, aes(x = freq_MT, y = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
Pl_hist_2 <-
ggplot(myt3, aes(x = str)) +
geom_histogram(bins = 10, color = "black", aes(fill = morph)) +
facet_wrap(~Subset, ncol = 1, scales = "free_x") +
scale_fill_manual(values = c("cornflowerblue", "red" )) +
theme_bw() +
theme(panel.grid = element_blank()) +
guides(fill = "none") +
labs(x = "Structure score", y = "Count") +
coord_flip()
Pl_hist_2
plot_grid(Pl_hist_2, Pl_no_gam, ncol = 2,  rel_widths = c(0.5, 1))
plot_grid(Pl_hist, Pl_mod_gam, Pl_hist_2, Pl_no_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist, Pl_mod_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_no_gam, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "hv")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "v")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "h")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, labels = c("A", "B"), rel_widths = c(0.5, 1), align = "vh")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, rel_widths = c(0.5, 1), align = "vh")
plot_grid(Pl_hist_2, Pl_no_gam,Pl_empty, Pl_empty, ncol = 2, rel_widths = c(0.5, 1), align = "hv")
# Chunk 1: setup
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, warning = FALSE, message = FALSE)
library(knitr)
# Chunk 2
library(lme4)
library(ggplot2)
library(reshape2)
library(sjstats)
library(dplyr)
library(car)
library(doBy)
library(pROC)
library(betareg)
library(lmtest)
library(broom)
library(mgcv)
myt <- read.table("data_salinity3.csv", header = T, sep = ",")
#
# myt_overseas <- myt[myt$dataset == "overseas", ]
#
# myt <- myt[myt$dataset != "overseas", ]
# str(myt)
myt$Sp [myt$str > 0.5] <- "M.trossulus" #Лучше обозначать так!
myt$Sp [myt$str <= 0.5] <- "M.edulis"
myt$Sp <- factor(myt$Sp)
# Оставляем только мидий, у которых есть оценка морфотипа
myt2_all <- myt[!is.na(myt$ind), ]
# Вводим обозначения для морфотипов
myt2_all$morph <- ifelse(myt2_all$ind == 1, "T_m", "E_m")
myt2_all$morph <- factor(myt2_all$morph)
### Объединяем популяции в данных Сары #####
# myt2_all$pop2 <- myt2_all$pop
#
# myt2_all$pop[myt2_all$pop %in% c("CBCP", "CBSC")] <- "CB"
#
# myt2_all$pop[myt2_all$pop %in% c("MDRE",   "MDRW")] <- "MDR"
# Подразделяем данные на сабсеты
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "barents" & myt2_all$sal_place == "normal"] <- "BH"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "normal"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "white" & myt2_all$sal_place == "fresh"] <- "WSBL"
myt2_all$Subset[myt2_all$sea == "Baltic"] <- "BALT"
myt2_all$Subset[myt2_all$sea == "GOM"] <- "GOM"
myt2_all$Subset[myt2_all$sea == "Norway"] <- "NORW"
myt2_all$Subset[myt2_all$sea == "Scotland"] <- "SCOT"
myt2_all$Subset <- factor(myt2_all$Subset, levels = c("WSBL", "BH", "BALT", "GOM", "NORW" , "SCOT"))
# Частота M.trossulus в популяции, вычисленная как срденее значение structure
freq_MT <- summaryBy( str ~ pop, data = myt2_all)
names(freq_MT) <- c("pop", "freq_MT")
myt2_all <- merge(myt2_all, freq_MT)
myt2 <- myt2_all %>% filter(Subset %in% c("WSBL", "BH", "BALT", "GOM" ))
# Бинарное обозначение видов
myt2$Sp2 <- ifelse(myt2$Sp == "M.trossulus", 1, 0)
#Correct identification
myt2$congr <- ifelse((myt2$ind == 1 & myt2$Sp == "M.trossulus") | (myt2$ind == 0 & myt2$Sp == "M.edulis"), 1, 0   )
theme_set(theme_bw())
Pl_base <- ggplot(myt2, aes(x = freq_MT, y = str)) + scale_fill_gradient(low = "yellow", high = "red") + guides(fill = "none") + labs(x = "Prevalence (proportion of M.trossulus)", y = "Structure") + facet_wrap(~Subset)
# + geom_density2d()
# Pl_base + geom_point(aes(fill = ind), shape = 21)
# Chunk 3
mod_gam <- gam(ind ~ s(str, freq_MT, by = Subset, bs = "tp", k = 10) + Subset, data = myt2, family = "binomial")
# summary(mod_gam)
summary(mod_gam)
#
library(broom)
tidy (mod_gam)
tidy (summary(mod_gam))
tidy ((mod_gam))
tidy.gam(mod_gam, parametric = T)
tidy(mod_gam, parametric = T)
tidy(mod_gam, parametric = TRUE)
tidy(mod_gam, parametric = F)
write.table(tidy(mod_gam, parametric = F), "clipboard")
write.table(tidy(mod_gam, parametric = F), "clipboard", sep = "\t")
write.table(tidy(mod_gam, parametric = F), "clipboard", sep = "\t", dec = ",")
mod_gam_res <- tidy(mod_gam, parametric = F)
mod_gam_res[, 2:4] <- round(mod_gam_res[, 2:4], 1)
mod_gam_res
mod_gam_res[, 5] <- round(mod_gam_res[, 5], 4)
mod_gam_res
write.table(mod_gam_res, "clipboard", sep = "\t", dec = ",")
