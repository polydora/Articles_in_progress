---
title: "Характеристика популяции *Semibalanus balanoides* на литорали острова Ряжкова летом 2022 г. "
author: "В. М. Хайтов"
output: 
      word_document:
                reference_docx: Letopis_template.docx
                fig_width: 6
                fig_height: 6

 
abstract: |
    **Хайтов В. М. Характеристика популяции *Semibalanus balanoides* на литорали острова Ряжкова летом 2022г. ** // Марченков А. В.  (ред.) Летопись природы Кадалакшского заповедника за 2022 год (ежегодный отчет). Кандалакша. Т.1 (Летопись природы Кандалакшского заповедника, кн. ++)
    Рассматриваются данные по учету обилия сеголеток и взрослых балянусов на литоральных валунах летом 2022.   
    
    **Khaitov V.M.  Population characteristics of * Semibalanus balanoides* on the intertidal zone  of Ryazhkov Island in the summer of 2022** // Marchenkov A. V. (ed.)  The Chronicle of Nature by the Kandalaksha Reserve for 2022 (Annual report).  Kandalaksha. V.1. (The Chronicle of Nature by the Kandalaksha Reserve, Book N ++)
     The data on abundance of yearlings and adult barnacls on boulders in summer months of 2022 are reviewed.   
      
---

```{r setup, include=FALSE}

library(reshape2)
library(knitr)
library(ggplot2)
library(ggmap)
library(dplyr)
library(cowplot)
library(readxl)

library(flextable)


opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)


theme_set(theme_bw())
options(figcap.prefix = "Рисунок", figcap.sep = ".", figcap.prefix.highlight = "**" )


editor <- "Марченков А. В."
editor_eng <- "Marchenkov A. V."

# Функция, задающая нумерацию рисунков

figRef <- local({
    tag <- numeric()
    created <- logical()
    used <- logical()
    function(label, caption, prefix = options("figcap.prefix"), 
        sep = options("figcap.sep"), prefix.highlight = options("figcap.prefix.highlight")) {
        i <- which(names(tag) == label)
        if (length(i) == 0) {
            i <- length(tag) + 1
            tag <<- c(tag, i)
            names(tag)[length(tag)] <<- label
            used <<- c(used, FALSE)
            names(used)[length(used)] <<- label
            created <<- c(created, FALSE)
            names(created)[length(created)] <<- label
        }
        if (!missing(caption)) {
            created[label] <<- TRUE
            paste0(prefix.highlight, prefix, " ", i, sep, prefix.highlight, 
                " ", caption)
        } else {
            used[label] <<- TRUE
            paste(prefix, tag[label])
        }
    }
})


```




```{r}
# Читаем данные
bal <- read_excel("data/Balanus_Ryazhkov_2012_2022.xlsx")
bal$N <- bal$N/60 + 67
bal$E <- bal$E/60 + 32

# str(bal_22)
# bal_print <- bal

bal$Site <- factor(bal$Site)

levels(bal$Site) <- c("Восточный берег", "Северная губа", "Западный берег", "Южная губа")


# ggRyazhkov <- read.table("data/ggRyazhkov.csv", header = T, sep = ";")

load("data/Ryazh_map.RData")


bal_22 <- bal %>% filter(Year %in% c(2022))

```



На литорали  острова Ряжкова было выделено 4 сайта (Южная губа, Восточный берег, Северная губа и Западный берег), в каждом из них ежегодно выбирается по несколько валунов. Координаты точек расположения валунов засекаются с помощью спутникового навигатора. Если несколько валунов расположены в непосредственной близости друг от друга,  то засекаются координаты только одного из них. Расположение точек сбора материала, обследованных  в 2022 году приведено на  `r figRef("Stone")`. Координаты обследованных в 2022 г камней приведены в таблице +.1.

```{r}
ft <-
bal_22 %>% 
  group_by(Site, N_stone) %>% 
  summarise(Lat = mean(N), Long = mean(E)) %>% 
  flextable()

ft <- set_caption(ft, "Таблица +.1. Координаты камней, на которых проводился учет балянусов в 2022 г. Coordinates of stones where barnacles were counted in 2022.")


ft  %>%  
  set_header_labels(values = c("Участок",  "Камень", "Широта", "Долгота")) %>% 
  fontsize(size = 10, part = "all")



```

\pagebreak

Валуны, использованные в анализе, располагались не выше пояса фукоидов и имели в диаметре не менее 1 метра. Обилие балянусов подсчитывалось на двух сторонах валуна (обращенной к морю (“Sea”) и обращенной к суше (“Land”). На каждой стороне было заложено по три площадки 10х10 см, располагавшихся на высоте 30 см от поверхности грунта. Рамка, ограничивающая площадку, была разбита на 25 квадратов со стороной 2 см. В трех случайно выбранных квадратах было подсчитано обилие балянусов следующих классов: Живые сеголетки, Мертвые сеголетки, Живые особи возрастом 1+ и более (далее взрослые), Мертвые взрослые особи. Данные, по учетам балянусов в 2020 и2021 годах, приведены в таблице +.2. 







``` {r, fig.cap=figRef("Stone", "Расположение камней, на которых проводился учет балянусов, на побережье о. Ряжкова (2022 г.). Position of stones where barnacles were counted on the shore of Ryazhkov island in 2022"), , fig.hight= 4, fig.wdth = 4}

ggmap(Ryazh_map,  base_layer=ggplot(data=bal_22, aes(x=E, y=N))) + 
  geom_point(shape=21, fill="yellow", size = 4) + 
  theme(axis.text = element_blank(), axis.title = element_blank(), axis.ticks = element_blank()) +
  facet_wrap(~Year)

```


```{r}
bal_melt <- melt(bal_22, id.vars = c("Year",	"Site",	"N_stone",	"Exposition",	"Core",	"Square", "N", "E"), variable.name = "Stage", value.name = "Abundance")

bal_melt$Stage <- factor(bal_melt$Stage, labels = c("Живые сеголетки", "Мертвые сеголетки", "Живые взрослые", "Мертвые взрослые"))

```



`r figRef("Abund22")` демонстрирует обилие разных стадий на разных точках в 2022 г. Самое мощное пополнение в этом году, как и в прошлые годы, происходило на Западном берегу и в Южной губе. Меньше всего молоди осело  на Восточном берегу. Обилие взрослых особей, как и в прошлые годы, не демонстрировало значимой вариации между отдельными сайтами. Таким образом, основное варьирование плотности поселения балянусов определяется изменчивостью интенсивности оседания сеголеток.  



Анализ многолетних тенденций изменения численности молоди балянусов (`r figRef("Abund_dynam")`) показал, что плотность поселения демонстрирует циклические колебания на всех точках мониторинга. Вместе с тем, годы, на которые приходятся пики обилия, совпадают на разных участках. То есть ход динамики пополнения молодью в разных участка популяции более или менее согласован.  Это можно трактовать как следствие того, что изменения регулируются некоторыми "глобальными" факторами, действующими в масштабах разброса точек наблюдения. 

Данные мониторинга температуры воды и солености, который проводится в Южной губе о. Ряжкова (см. отдельную главу Летописи), позволяют оценить связи этих показателей с наблюдаемой динамикой пополнения поселений балянусов молодью. Для этого были вычислены средине значения температуры воды и солености летние месяцы (`r figRef("Hydr_dynam")`). Однозначной связи между периодами всплеска обилия молоди и гидрологическими параметрами не выявляется. Однако видно, что наиболее скоординированные с динамикой обилия молоди изменения демонстрирует соленость. Можно заметить, что всплески обилия молоди приходятся на годы с более высокой соленостью (а также в годы, которым предшествовала более высокая соленость). Возможно, что наблюдаемая корреляция свидетельствует о важной роли солености, в формировании половых продуктов у взрослых балянусов и в выживании личинок. 



```{r, fig.cap=figRef("Abund22", "Обилие сеголеток и взрослых балянусов (экз. на 4 кв.см.) в 2022 году. Abundanc of juveniles and adult barnacles (ind per 4 sq. cm) in 2022."), fig.height=5}


bal_melt2 <-  bal_melt %>% filter(Stage %in% c("Живые сеголетки", "Живые взрослые")) %>% filter(Year == 2022)
  
ggplot(bal_melt2, aes(x = Site, y =Abundance)) + 
  geom_boxplot() +
  facet_wrap(~Stage, scales = "free_y")+ 
  labs(x = "", y = "Плотность поселения (экз/4кв.см)") + 
  theme(axis.text.x = element_text(angle = 90))



```



\pagebreak

```{r , fig.cap=figRef("Abund_dynam", "Многолетняя динамика обилия сеголеток на разных участках. The dynamics of the yearlings' abundance in different sites")}

bal_melt <- melt(bal, id.vars = c("Year",	"Site",	"N_stone",	"Exposition",	"Core",	"Square", "N", "E"), variable.name = "Stage", value.name = "Abundance")

bal_melt$Stage <- factor(bal_melt$Stage, labels = c("Живые сеголетки", "Мертвые сеголетки", "Живые взрослые", "Мертвые взрослые"))

bal %>%   
  mutate(Total_N = Juveniles_Alive) %>% 
  group_by(Site, Year) %>% 
  summarise(N_total = mean(Total_N, na.rm = T)) %>% 
  ggplot(., aes(x = Year, y = (N_total+1))) + 
  facet_wrap(~Site) +
  geom_line() +
  geom_point(shape = 21, fill= "black") + 
  labs(x = "Годы", y = "Плотность поселения (экз/4кв.см)", fill = "", color = "") + 
  theme(legend.position = "bottom") +
   scale_x_continuous(breaks=seq(min(bal$Year), max(bal$Year), 2))
  
```

\pagebreak


```{r}
library(lubridate)
library(patchwork)


hydr <- read_excel("data/Hydrology_monitoring_Youzhnzya_inlet_2007_2022.xlsx", na = "NA")


hydr$Date2 <- as.POSIXct(hydr$Date_Time, format = "%d.%m.%Y %H", tz = "Europe/Moscow")


hydr_mean <- hydr %>%  filter (month(hydr$Date2) %in% c(6:8)) %>% filter(Year >= 2012) %>% group_by(Year) %>% summarise(Mean_S = mean(S, na.rm = T), Mean_Water_T = mean(Water_T, na.rm = T)) 

Pl_Bal <- 
bal %>%
  mutate(Total_N = Juveniles_Alive) %>%
  group_by(Year) %>%
  summarise(N_total = mean(Total_N, na.rm = T)) %>% 
  ggplot(., aes(Year, N_total))+
  geom_line() +
  geom_point() +
  scale_x_continuous(breaks=seq(min(bal$Year), max(bal$Year), 2)) + 
  labs(y = "Обилие (экз/4 кв.см)")


Pl_Sal <- 
ggplot(hydr_mean, aes(Year, Mean_S)) +
  geom_path(color = "blue") +
  geom_point(color = "darkblue") +
  scale_x_continuous(breaks=seq(min(bal$Year), max(bal$Year), 2)) + 
  labs(y = "Соленость (промилле)") +
  geom_hline(yintercept = mean(hydr_mean$Mean_S, na.rm = T), linetype = 2)

Pl_W_T <- 
ggplot(hydr_mean, aes(Year, Mean_Water_T)) +
  geom_path(color = "red") +
  geom_point(color = "red") +
  scale_x_continuous(breaks=seq(min(bal$Year), max(bal$Year), 2)) + 
  labs(x = "Годы",y = "Температура воды (С)") +
  geom_hline(yintercept = mean(hydr_mean$Mean_Water_T, na.rm = T), linetype = 2)



```


```{r , fig.cap=figRef("Hydr_dynam", "Динамика обилия сеголеток (среднее значение по всем точкам наблюдения, **A**),  солености (**B**) и температуры воды (**C**). Пунктирная линия отражает многолетние средние значения в июне. Dynamics of juvenile barnacles' abundance (average for all observation sites, **A**), salinity (**B**) and water temperature (**C**).The dotted line represents multi-year averages.")}

library(cowplot)
plot_grid(Pl_Bal, Pl_Sal, Pl_W_T, ncol = 1, labels = "AUTO", label_size = 10, hjust = 0.1) 

```




\pagebreak



```{r}

colname <- c("Сайт", "Камень","Направление", "Рамка", "Сеголетки живые", "Сеголетки мертвые", "Взрослые живые", "Взрослые мертвые")

ft <- 
bal_22 %>%  
  select(-Year, - N, -E, -Square ) %>% 
  flextable() 


#Регуляция формы записи чисел
ft <- colformat_double(ft, j = 1,  big.mark = "", digits = 0)

ft <- set_header_labels(ft, values = colname)

ft <- set_caption(ft, "Таблица +.2 Обилие сеголеток и взрослых балянусов  на побережье о. Ряжкова в 2022 г. (экз. на 4 кв.см.).  Abundance of barnacles juveniles adults on the shore of Ryazhkov island in 2022 (ind. per 4 sq. cm)")

# kable(bal_22, digits = c(0,0,0,0, 6,6,0,0,0,0), missing = "нет данных", style = "multiline",  split.tables = Inf, split.cells = 10, col.names = colname)

#установка парамтеров грид в таблице
library(officer)
std_border = fp_border(color="gray", width = 1)

ft %>% 
  border_inner_h(border = std_border ) %>% 
  border_inner_v(border = std_border ) %>% 
  fontsize(size = 10, part = "all") %>% 
  fontsize(size = 9, part =  'header')


# %>% 
#   autofit(part = "all")


```

