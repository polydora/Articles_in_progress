---
title: "Long-term dynamics of catfish diet"
author: "В. М. Хайтов"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(knitr)

opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library(readxl)
library(mgcv)
library(ggplot2)
library(cowplot)
library(gratia)
library(reshape2)
library(dplyr)
library(broom)
library(stringr)
library(lubridate)
library(patchwork)

theme_set(theme_bw())

```



## Сезонная и многолетняя динамика частоты пустых кишечников

```{r}

zub_empty <- read_excel("Data/Зубатка_питание2001-2023.xlsx", sheet = "All")

zub_empty <- 
  zub_empty %>% 
  mutate(Date = paste(Date, "/", Year, sep = ""), Sex = factor(Sex))

zub_empty$Date <- as.Date(zub_empty$Date, format ="%d/%m/%Y") 

zub_empty$DOY <- yday(zub_empty$Date)


```


Вот модель, которой описывается динамика частоты пустых кишечников. Здесь моделируется поведение вероятности встретить пустой кишечник в зависимости от дня от начала года (DOY, что можно трактовать, как сезонную динамику) и в зависимости от года (многолетняя динамика).


```{r, echo=TRUE}

mod_empty <- gam(Out  ~ s(DOY, by = Sex, bs = "cr", k = 6) + s(Year, by = Sex, bs = "cr", k = 6) + Sex, family = "binomial", data = zub_empty)


```


Во результаты подбора этой модели 

```{r}
kable(tidy(mod_empty))

```

Важно! Для самцов значимой сезонной динамики нет. А вот у самок - да, есть значимое сезонное изменение часты пустых желудков.



Вот визуализация полученной модели.

```{r}

Begin_august <- yday(x = as.Date("2023-08-01"))
Begin_julay <- yday(x = as.Date("2023-07-01"))



Pl_DOY_f <- 
draw(mod_empty, select = 1) + 
  geom_hline(yintercept = 0, linetype = 2) +
  geom_vline(xintercept = Begin_julay)+
  geom_vline(xintercept = Begin_august) +
  geom_text(aes(x = 175, y = 1.5, label = "June"))+
  geom_text(aes(x = 195, y = 1.5, label = "July"))+
  geom_text(aes(x = 225, y = 1.5, label = "August"))


Pl_DOY_m <- 
draw(mod_empty, select = 2) + 
  geom_hline(yintercept = 0, linetype = 2)



Pl_Year_f <- 
draw(mod_empty, select = 3) + 
  geom_hline(yintercept = 0, linetype = 2)

Pl_Year_m <- 
draw(mod_empty, select = 4) + 
  geom_hline(yintercept = 0, linetype = 2)




```




```{r}

plot_grid(Pl_DOY_f, Pl_DOY_m)

```

Для самок максимум пустых кишечников приходится на конец июля-начало августа. Это, как я полагаю,  совпадает с периодом нереста. У самцов такой динамики нет.



```{r}
plot_grid(Pl_Year_f, Pl_Year_m)


```

Многолетнюю динамику объяснить пока не могу. Возможно это связано с тем, что в годы максимальной частоты пустых желудков  отловы проводились в период нереста. Однако этому противоречит то, что у самцов, в целом, многолетние изменения были такими же, как у самок. Возможно, что, все же, в период 2015-2017 и, возможно, в 2020-2023 гг был какой-то голодный период.    


**Вопрос.** Не следует ли отсюда, что многолетнюю динамику рациона лучше смотреть по самцам?

