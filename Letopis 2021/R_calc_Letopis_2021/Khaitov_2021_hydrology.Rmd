---
title: "Динамика гидрологических показателей в Южной губе о. Ряжкова в летние месяцы 2021 года."
author: "В. М. Хайтов"
output: 
      word_document:
                reference_docx: Letopis_template.docx
                fig_width: 7
                fig_height: 5

 
abstract: |
    **Хайтов В. М. Динамика гидрологических показателей в Южной губе о. Ряжкова в летние месяцы 2021 года** // Марченков А. В. (ред.) Летопись природы Кадалакшского заповедника за 2021 год (ежегодный отчет). Кандалакша. Т.1 (Летопись природы Кандалакшского заповедника, кн. ++)
    
    Рассматриваются данные гидрологических проб, бравшихся ежедневно с 01.06.21 по 20.08.21
    
    **Khaitov V.M. Dynamics of salinity, water and air  temperature and wind characteristics in the Youzhnaya inlet (Ryazhkov island)** // Marchenkov A.V. (ed.)  The Chronicle of Nature by the Kandalaksha Reserve for 2021 (Annual report).  Kandalaksha. V.1. (The Chronicle of Nature by the Kandalaksha Reserve, Book N ++)
    
    The data of hydrological samples is discussed. Samples were collected during most summer months.
      
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(reshape2)
library(knitr)
library(pander)
library(readxl)
library(dplyr)


editor <- "Марченков А. В."
editor_eng <- "Marchenkov A. V."

Year <- 2021

# Функция, задающая нумерацию рисунков

figRef <- local({
    tag <- numeric()
    created <- logical()
    used <- logical()
    function(label, caption, prefix = options("figcap.prefix"), 
        sep = options("figcap.sep"), prefix.highlight = options("figcap.prefix.highlight")) {
        i <- which(names(tag) == label)
        if (length(i) == 0) {
            i <- length(tag) + 1
            tag <<- c(tag, i)
            names(tag)[length(tag)] <<- label
            used <<- c(used, FALSE)
            names(used)[length(used)] <<- label
            created <<- c(created, FALSE)
            names(created)[length(created)] <<- label
        }
        if (!missing(caption)) {
            created[label] <<- TRUE
            paste0(prefix.highlight, prefix, " ", i, sep, prefix.highlight, 
                " ", caption)
        } else {
            used[label] <<- TRUE
            paste(prefix, tag[label])
        }
    }
})

options(figcap.prefix = "Рисунок", figcap.sep = ".", figcap.prefix.highlight = "**")

```



```{r}
# Читаем данные
hydr <- read.csv("data/hydrology_2021.csv", encoding = "UTF-8")

# hydr$Date_Time <- paste(format(hydr$date, format = "%d-%m-%Y"), format(hydr$time, format = "%H"))

hydr$Date2 <- as.POSIXct(hydr$Date_Time, tz = "Europe/Moscow", format = "%d.%m.%Y %H")

hydr$Date <- format(hydr$Date2, "%d.%m:%H")

hydr$Date_day <- format(hydr$Date2, "%d.%m")


hydr$Air_T <- round(as.numeric(hydr$Air_T, 1))
hydr$Water_T <- round(as.numeric(hydr$Water_T, 1))


hydr_print <- data.frame(Year = Year, Date = hydr$Date, Air_T = hydr$Air_T, Salinity = hydr$S, Water_T = hydr$Water_T)

hydr_print2 <- hydr_print
hydr_print[is.na(hydr_print)] <- "нет данных"

col_names <- c("Год", "Дата и время", "Температуа воздуха", "Соленость", "Температуа воды")



```


Ежедневные метеонаблюдения были проведены в течение трех месяцев с 1 июня  по 20 августа `r Year` г. Температура воздух оценивалась с помощью цифрового термометра на высоте человеческого роста. Регистрация температуры воды осуществлялась на глубине 1 м ртутным термометром, свешенным с головки наплавного причала кордона «Ряжков». Замеры температуры проводились в стандартные временные интервалы 0.00, 12.00 и 18.00 часов (при возможности, проводились дополнительные замеры в 6.00).


Отбор проб солености, по возможности, осуществлялся в те же часы. Взятие проб воды производилось на той же точке, в которой был размещен термометр, регистрирующий температуру воды. Проба бралась с глубины 1 м. Определение солености осуществлялось с помощью ручного рефрактометра, с точностью до 1 промилле. Данные по измеренным показателям приведены в таблице +.1. 

Вследствие обострения эпидемиологической обстановки в `r Year` г., заезд волонтеров, выполняющих метеорологические наблюдения, не состоялся. Это обусловило отсутствие данных за первую половину июля.  


**Таблица +.1**  Температура воздуха и воды и соленость в Южной губе о. Ряжкова  летом `r Year` г.   

Table +.1 Air and water temperature and salinity in the Youzhnaza inlet (Ryazhkov island) in `r Year`


```{r}

kable(hydr_print,  col.names = col_names)

```




```{r, fig.cap=figRef("Sal", "Динамика солености и температуры воды и воздуха в Южной губе. Линии демонстрируют непараметрическую сглаживающую функцию (аддитивная модель, GAM).  Dynamics of water salinity and temperature of water and air in Youzhnaya inlet. The lines show the nonparametric smoother (additive model, GAM)")}

library(ggplot2)
library(gridExtra)


theme_set(theme_bw())

Means <- hydr %>% group_by(Date_day) %>% summarise(Mean_S = mean(S, na.rm = T), Mean_WT = mean(Water_T, na.rm = T), Mean_AT = mean(Air_T, na.rm = T)) 

Means$Date_day_2 <- as.POSIXct(paste(Year, Means$Date_day), format = "%Y %d-%m" )


Pl_sal <- ggplot(hydr, aes(x= Date2 , y = S)) + geom_point(size = 0.5) + geom_line(data = Means, aes(x = Date_day_2,  y = Mean_S), color = "gray") + xlab("") + ylab("Соленость") + geom_smooth(se = F, size = 1, color = "blue", method = "gam") 


Pl_Temp_W <- ggplot(hydr, aes(x= Date2 , y = Water_T)) + geom_point(size = 0.5) + geom_line(data = Means, aes(x = Date_day_2,  y = Mean_WT), color = "gray")  + geom_smooth(se = F, size = 1, color = "blue",  method = "gam") + xlab("") + ylab("Температура воды")

Pl_Temp_A <- ggplot(hydr, aes(x= Date2 , y = Air_T)) + geom_point(size = 0.5) + geom_line(data = Means, aes(x = Date_day_2,  y = Mean_AT), color = "gray")  + geom_smooth(se = F, size = 1, color = "blue", method = "gam") + xlab("Даты") + ylab("Температура воздуха")

grid.arrange(Pl_sal, Pl_Temp_W, Pl_Temp_A, ncol = 1)

```







Соленость воды, как и в предыдущие годы, в `r Year` г. демонстрировала колебания (`r figRef("Sal")`), находящиеся в противофазе с колебаниями температуры воды. Поскольку существенной связи этих колебаний с изменением температуры воздуха не наблюдается, то данная картина, вероятно, обуславливается динамикой смены водных масс. В акватории периодически наблюдается подход к поверхности холодной и более соленой водной массы, которая постепенно опресняется и нагревается. Теплая опресненная водная масса остается на поверхности до следующего подхода более холодных и осолоненных вод. 


В данный год подход холодной водной массы происходил от середины июня к его концу. Судя по первичным данным (точки на `r figRef("Sal")`) в первой половине июля  происходил процесс опреснения и нагрева этих вод. Однако в последних числах июня произошел новый  приток холодной воды с более высокой соленостью. Далее, вплоть до конца августа, эта водная масса опреснялась и ее температура повышалась. 



В `r Year` году средняя соленость воды была несколько выше, чем в прошлом году, когда она достигла минимальной отметки за весь период наблюдений (Табл. +.+). Вместе с тем, в целом, соленость в `r Year` г., как и в предыдущий год, была ниже многолетнего среднего (`r figRef("Temp_long")`). Температура воды, в последние два года была выше многолетнего среднего. Оба параметра (соленость и температура воды), демонстрируя периодические колебания, не показывали явной связи с многолетним трендом температуры воздуха (`r figRef("Temp_long")`). Последняя демонстрировала отчетливую тенденцию к увеличению на протяжении всего периода наблюдений (`r figRef("Temp_long")`). 



```{r}
hydr_long <- read.csv("data/Hydrology_monitoring_Youzhnzya_inlet_2007_2021.csv")

hydr_long$Air_T <- as.numeric(hydr_long$Air_T )
hydr_long$Water_T <- as.numeric(hydr_long$Water_T)
hydr_long$S <- as.numeric(hydr_long$S)



hydr_long$Date2 <- as.POSIXct(hydr_long$Date_Time, format = "%d.%m.%Y %H", tz = "Europe/Moscow")


hydr_long_all <-  hydr_long

hydr_long_all$Year <- format(hydr_long_all$Date2, "%Y")




Means_long <- hydr_long_all %>% group_by(Year) %>% summarise(Mean_S = mean(S, na.rm = T), SD_S = sd(S, na.rm = T), Mean_WT = mean(Water_T, na.rm = T), SD_WT = sd(Water_T, na.rm = T), Mean_AT = mean(Air_T, na.rm = T), SD_AT = sd(Air_T, na.rm = T))

Means_long$Year <- as.numeric(Means_long$Year)

Means_long[ ,2:7] <- round(Means_long[ ,2:7], 2)



hydr_long_all_print <- with(Means_long, data.frame(Year = Year,
  Salinity = paste(Mean_S, "±", SD_S),
  Water_T = paste(Mean_WT, "±", SD_WT),
  Air_T = paste(Mean_AT, "±", SD_AT))
  )

```






```{r, fig.cap=figRef("Temp_long", "Многолетняя динамика солености, температуры воды и воздуха в Южной губе. Горизонтальная пунктирная линия отражает средние многолетние значения. Линия тренда отражается аддитивной моделью (GAM). Long-term dynamics of water salinity, temperature of water and air in Youzhnaya inlet. The horizontal dashed line represents the multiyear average values. The trend line is reflected by the nonparametric additive smoother (GAM).")}

library(patchwork)

Pl_long_S <- 
  ggplot(hydr_long_all, aes(x= as.Date(Date2), y = S)) + 
  geom_point(color = "gray", size = 0.1) + 
  geom_smooth(se = F, size = 1, color = "blue", method = "gam") +
  scale_x_date(date_breaks = "2 year", date_labels =  "%Y") + 
  geom_hline(yintercept = mean(hydr_long_all$S, na.rm = T), linetype = 2, size = 1) +
  labs(x = "Годы", y = "Соленость") +
  theme(axis.text.x = element_text(angle = 90))


Pl_long_WT <- 
  ggplot(hydr_long_all, aes(x= as.Date(Date2), y = Water_T)) + 
  geom_point(color = "gray", size = 0.1) + 
  geom_smooth(se = F, size = 1, color = "blue", method = "gam") +
  scale_x_date(date_breaks = "2 year", date_labels =  "%Y") + 
  geom_hline(yintercept = mean(hydr_long_all$Water_T, na.rm = T), linetype = 2, size = 1)+
  labs(x = "Годы", y = "Температура воды") +
  theme(axis.text.x = element_text(angle = 90))



Pl_long_AT <- 
  ggplot(hydr_long_all, aes(x= as.Date(Date2), y = Air_T)) + 
  geom_point(color = "gray", size = 0.1) + 
  geom_smooth(se = F, size = 1, color = "blue", method = "gam") +
  scale_x_date(date_breaks = "2 year", date_labels =  "%Y") + 
  geom_hline(yintercept = mean(hydr_long_all$Air_T, na.rm = T), linetype = 2, size = 1)+
  labs(x = "Годы", y = "Температура воздуха")+
  theme(axis.text.x = element_text(angle = 90))


(Pl_long_AT)  + (Pl_long_S / Pl_long_WT ) 


```





**Таблица +.2**  Средние (± SD) значения солености, температуры воды и воздуха в Южной губе о. Ряжкова  в разные годы. Mean (± SD) values of salinity, water and air temperature in the Youzhnaza inlet (Ryazhkov island) in different years.

```{r}
kable(hydr_long_all_print, col.names = c("Годы", "Соленость", "Температура воды", "Температура воздуха"), align = "lccc" )
```




